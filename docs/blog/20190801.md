# 20190801 工作日志

## express-session

今天工作上，碰见了express-session问题
通过appscan一直都会搜索cookie secure问题，这个问题困扰得比较严重

到底怎么样才能够解决这个问题?

```js
const session = require('express-session');
app.set('trust proxy', 1)
let sessionConfig = {
          cookie: {

            secure: true,
            httpOnly: true,
        },
};

app.use(session(sessionConfig));

```

通过这样，根据express-session的文档 我们是成功打开了
但是问题来了....我们并没有成功登录，但是session会失效。问题在那里?

问题原来很简单。在nginx配置上

```nginx

        proxy_set_header X-Real-IP $remote_addr; 
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
```

在location 那里缺少了这几句。
特别是

```nginx
proxy_set_header X-Forwarded-Proto $scheme;
```

因为他决定了repson是https还是http，这样影响了session secure的接收和引入

